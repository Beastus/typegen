<!doctype html>

<html>
	<head>
		<title>TypeGen Demo</title>
		<link href="../modules/jquery/smoothness/jquery-ui-1.9.2.min.css" rel="stylesheet">
		<script src="../modules/jquery/jquery-1.8.3.min.js"></script>
		<script src="../modules/jquery/jquery-ui-1.9.2.min.js"></script>
		<script src="../modules/raphael/raphael-min.js"></script>
		<script src="../modules/tg/tg.js"></script>
		<script src="../modules/tg/tg.Glyph.js"></script>
		<script src="../modules/tg/tg.Font.js"></script>
		<style>
			body {
				background-color: #f3f3f3;
				font-family: sans-serif;
				font-size: 1em;
			}
			svg {
				border: solid 1px #ccc;
				background-color: #fff;
			}
			#params {
				position: absolute;
				width: 400px;
				height: 400px;
				left: 460px;
				top: 20px;
			}
			#reset {
				float: right;
				font-size: 0.9em;
			}
			.control {
				padding: 0.5em;
			}
			.control-label {
				margin-bottom: 0.5em;
			}
		</style>
	</head>
	<body>
		<div id="params">
			<h1>TypeGen Demo</h1>
			<button id="reset">&nbsp;</button>
			<h3>Parameters</h3>
			<div id="controls"></div>
		</div>
		<script>
			var key, i, len, control,
				paper = Raphael( 20, 20, 400, 400 ).setViewBox( -0.5, -0.5, 2, 2, true ),
				preview = paper.set(),
				guides = paper.set(),
				font = new tg.Font(),
				params = font.getParamNames(),
				glyph = font.getGlyph( 'A' ),
				controls = {},
				$controls = $( '#controls' );

			$( '#reset' )
				.button( {
					'icons': { 'primary': 'ui-icon-cancel' },
					'text': false
				} )
				.click( function () {
					var key;
					font.resetParams();
					for ( key in controls ) {
						controls[key].reset();
					}
					update();
				} );

			// Setup guides
			guides
				.push(
					// Ascent
					paper.path( 'M-1,-0.15L2,-0.15' ),
					// Cap
					paper.path( 'M-1,0L2,0' ),
					// Base
					paper.path( 'M-1,1L2,1' ),
					// Descent
					paper.path( 'M-1,1.3L2,1.3' ),
					// Left
					paper.path( 'M0,-1L0,2' )
				)
				.attr( {
					'stroke': '#ddd',
					'stroke-width': '0.5',
				} );

			function update() {
				var meanLine = font.getParamValue( 'meanLine' );
				preview.remove();
				preview.push(
					// Mean
					paper.path( 'M-1,' + meanLine + 'L2,' + meanLine )
						.attr( {
							'stroke': '#ddd',
							'stroke-width': '0.5',
						} ),
					// Character
					paper.path( glyph.getPath() )
						.attr( {
							'fill': 'rgba(0,0,0,0.75)',
							'stroke': 'rgb(128,128,128)',
							'stroke-width': '1'
						} )
				);
			}

			function Slider( param ) {
				var value = font.getParamValue( param ),
					min = font.getParamMin( param ),
					max = font.getParamMax( param ),
					step = ( max - min ) * 0.001;

				// Properties
				this.$ = $( '<div>' );
				this.$label = $( '<div>' );
				this.$slider = $( '<div>' );
				this.initialValue = value;

				// Initialization
				this.$.addClass( 'control' );
				this.$label
					.addClass( 'control-label' )
					.text( param );
				this.$slider
					.addClass( 'control-slider' )
					.slider( {
						'value': value,
						'min': min,
						'max': max,
						'step': step,
						'slide': function ( event, ui ) {
							font.setParamValue( param, ui.value );
							update();
						}
					} );
				this.$.append( this.$label, this.$slider );
			};

			Slider.prototype.reset = function () {
				this.$slider.slider( 'value', this.initialValue );
			};

			for ( var i = 0, len = params.length; i < len; i++ ) {
				control = new Slider( params[i] );
				$controls.append( control.$ );
				controls[params[i]] = control;
			}

			update();
		</script>
	</body>
</html>